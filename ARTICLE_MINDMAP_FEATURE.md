# 文章思维导图功能

## 功能概述

新增的文章思维导图功能可以自动检测网页中的文章内容，将其转换为Markdown格式，然后通过AI生成思维导图。

## 功能特点

### 🔍 智能文章检测
- 自动识别网页中的文章内容
- 支持多种常见的文章容器格式
- 过滤广告、导航等无关内容
- 确保内容质量（最少500字符）

### 📝 HTML到Markdown转换
- 智能转换HTML结构为Markdown格式
- 保留文章的层次结构（标题、段落、列表等）
- 支持表格、引用、代码块等格式
- 自动清理和优化输出内容

### 🧠 AI思维导图生成
- 使用与视频字幕相同的AI服务
- 支持多种AI提供商（OpenAI、Gemini、Claude、通义千问）
- 生成结构化的思维导图数据
- 支持节点关系、箭头连接、内容总结

### 💾 智能缓存
- 24小时缓存机制
- 避免重复处理相同文章
- 提升用户体验

## 使用方法

1. **自动检测**：打开包含文章的网页，插件会自动检测文章内容
2. **生成思维导图**：点击"生成思维导图"按钮
3. **查看结果**：思维导图将在侧边面板中显示
4. **交互操作**：可以隐藏/显示思维导图，关闭面板

## 支持的网站

- 博客网站（如Medium、知乎专栏等）
- 新闻网站
- 技术文档网站
- 学术论文网站
- 任何包含结构化文章内容的网页

## 排除的网站

为避免冲突，以下网站不会启用文章检测功能：
- YouTube（已有专门的视频字幕功能）
- Bilibili（已有专门的视频字幕功能）

## 技术实现

### 文件结构
```
contents/
├── article-mindmap.tsx     # 主要的content script
utils/
├── html-to-markdown.ts     # HTML到Markdown转换工具
background/
├── index.ts               # 后台服务，处理AI API调用
```

### 核心组件

1. **ArticleMindmapPanel**: 主要的React组件
2. **HtmlToMarkdownConverter**: HTML转换工具类
3. **BackgroundAIService**: AI服务处理类

### 检测算法

文章检测使用多层次的选择器策略：

1. **优先级选择器**：
   - `article`
   - `[role="main"]`
   - `.post-content`
   - `.article-content`
   - 等等

2. **智能检测**：
   - 分析元素文本长度
   - 检查子元素数量
   - 验证段落结构

3. **内容过滤**：
   - 跳过广告、导航等元素
   - 过滤隐藏内容
   - 确保内容质量

## 配置要求

- 需要配置AI服务（与视频字幕功能共用）
- 需要有效的API密钥
- 网络连接正常

## 错误处理

- AI服务未配置：显示配置提示
- 网络错误：显示重试选项
- 内容检测失败：不显示面板
- API调用失败：显示错误信息

## 性能优化

- 延迟检测（2秒后执行）
- 内容长度限制（最大8000字符）
- 智能缓存机制
- 按需加载思维导图组件

## 隐私保护

- 文章内容仅在用户主动生成思维导图时发送给AI服务
- 不会自动收集或上传页面内容
- 缓存数据存储在本地
- 遵循用户的AI服务配置

## 未来改进

- [ ] 支持更多文章格式检测
- [ ] 添加文章摘要功能
- [ ] 支持批量处理
- [ ] 添加导出功能
- [ ] 优化思维导图样式
- [ ] 支持自定义检测规则